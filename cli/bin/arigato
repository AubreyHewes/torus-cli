#!/usr/bin/env node
// vim: set filetype=javascript;
'use strict';

var EventRegulator = require('event-regulator').EventRegulator;

function handleSignal () {
  process.exit(1);
}

function main () {
  var arigato = require('../lib/arigato');
  process.title = 'Arigato CLI';

  var subscriptions = new EventRegulator([
    [process, 'SIGTERM', handleSignal, true],
    [process, 'SIGINT', handleSignal, true],
    [process, 'SIGHUP', handleSignal, true]
  ]);

  var opts = {
    arigatoRoot: process.env.ARIGATO_ROOT,
    argv: process.argv
  };

  arigato.run(opts).then(function (success) {
    process.exit((success) ? 0 : 1);
  }, function (err) {

    if (err) {
      console.error(err.stack ? err.stack : err);
    }

    process.exit(1);
  });
}

if (require.main === module) {
  main();
}
