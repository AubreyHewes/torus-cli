#!/usr/bin/env node
// vim: set filetype=javascript;
'use strict';

var yargs = require('yargs');

var log = require('../lib/util/log').get('main');
var cmds = require('../lib/cmds');

function main () {
  cmds.load().then(() => {
    return cmds.process(yargs.argv);
  }).then((success) => {
    if (typeof success !== 'boolean' && typeof success !== 'number') {
      throw new Error('A command must return a boolean');
    }

    if (typeof success === 'boolean') {
      return process.exit((success) ? 0 : 1);
    }

    process.exit(success);
  }).catch((err) => {
    log.error('An error happened..');
    console.error((err instanceof Error) ? err.stack : err);
    process.exit(1);
  });
}

if (require.main === module) {
  main();
}
